%% Include packages.
\usepackage[top=0.95in,bottom=1in,left=0.85in,right=0.85in]{geometry}
\usepackage[main=english]{babel}                        % Advanced language support; must by loaded early
\usepackage{amsthm}                                     % Theorem and proof environments

%% Use XCharter for text, Source Code Pro for monospace, Lato for sans-serif, and XCharter-Math for math.
\usepackage{ifluatex}
\ifluatex                                               % If using lualatex, use fontspec to set the fonts
    \usepackage[no-math]{fontspec}
    \setmainfont{XCharter}
    \setsansfont{Lato}[Scale=MatchLowercase]
    \setmonofont{Source Code Pro}[Scale=MatchLowercase]
    \usepackage{unicode-math}
    \setmathfont{XCharter-Math.otf}[CharacterVariant={11,12}]
    \setmathfont{XCharter-Math}[range={cal,bfcal},StylisticSet=1]
    \renewcommand{\vec}{\symbfit}                       % Bold italic vectors
    \newcommand{\mat}{\symbf}                           % Bold upright matrices
\else
    \usepackage{mathtools}                              % Enhanced math (amsmath extension)
    \usepackage{XCharter}
    \usepackage[type1,defaultsans,scaled=0.945]{lato}   % Scale to (roughly) match XCharter setup
    \usepackage[type1,ttdefault]{sourcecodepro}
    \usepackage[xcharter,scaled=1.07]{newtxmath}        % Scale to (roughly) match LuaLaTeX setup
    \renewcommand{\vec}{\boldsymbol}                    % Bold italic vectors
    \newcommand{\mat}{\mathbf}                          % Bold upright matrices
    \renewcommand{\emptyset}{\varnothing}               % Empty set symbol consistent with LuaLaTeX
\fi

% %% Optionally make entire document sans-serif (uncomment to enable).
% \renewcommand{\familydefault}{\sfdefault}

%% Core typography and layout.
\usepackage{microtype}                                  % Improved typography and character protrusion
\usepackage[titles]{tocloft}                            % TOC customization; must be loaded before parskip/titlesec
\usepackage{parskip}                                    % Adjust paragraph spacing; after tocloft to avoid warnings

%% Figures, floats, captions, colors, boxes, and code listings.
\usepackage{graphicx}                                   % Displaying images and figures
\usepackage{caption}                                    % Caption customization
\usepackage{subcaption}                                 % Sub-captions within figures/tables; depends on caption
\usepackage{float}                                      % H float specifier
\usepackage{listings}                                   % Code listing environment
\usepackage{lstautogobble}                              % Auto-indent removal for listings
\usepackage{xcolor}                                     % Colors for text and boxes
\usepackage[most]{tcolorbox}                            % Colored and framed boxes; must come after listings

%% Lists, titles, and document structure.
\usepackage{enumitem}                                   % Customizable enumerate/itemize environments
\usepackage[sf,bf]{titlesec}                            % Section formatting; must follow tocloft
\usepackage[titletoc]{appendix}                         % Appendices; should follow titlesec
\usepackage{multicol}                                   % Multi-column environments
\usepackage{fancyhdr}                                   % Fancy headers/footers

%% Language, dates, and specialized content.
\usepackage{csquotes}                                   % Advanced quotation management; after babel
\usepackage[showdow,en-US]{datetime2}                   % Date/time formatting
\usepackage[exponent-product=\cdot]{siunitx}            % SI units; after math packages
\usepackage{chemformula}                                % Chemical formulae; after babel and fonts

%% Bibliography settings (build with lualatex -> biber -> lualatex x 2).
\usepackage[style=authoryear,
    maxbibnames=5,
    maxcitenames=2,
    giveninits=true,
    uniquelist=false,
    uniquename=init,
    seconds=true,
    urldate=iso,
]{biblatex}
\addbibresource{references.bib}
\newcommand\citep{\parencite}

%% Caption formatting.
\captionsetup{font=sf,labelfont=bf,justification=centering,width=0.9\textwidth}

%% Path to graphics folder.
\graphicspath{{./figures/}}

%% Commands for gradient, divergence, and curl operators.
\DeclareMathOperator{\Grad}{grad}
\DeclareMathOperator{\Div}{div}
\DeclareMathOperator{\Curl}{curl}

%% Commands for Big-Oh notation.
\newcommand{\oh}{\mathcal{O}}

%% Commands for the set of real numbers and Lagrangian/Laplace.
\newcommand{\R}{\mathbb{R}}
\newcommand{\La}{\mathscr{L}}

%% Commands for differentials.
\newcommand{\df}{\mathop{}\!\mathrm{d}}

%% Command for transpose.
\newcommand{\T}{\mathrm{T}}

%% Shrink bullet points.
\renewcommand{\labelitemi}{\raisebox{0.2ex}{\tiny$\bullet$}}

% %% Numbering within sections (uncomment to enable).
% \numberwithin{equation}{section}
% \numberwithin{table}{section}
% \numberwithin{figure}{section}

%% Fancy page style.
\fancypagestyle{fancy}{
    \fancyhf{}
    \fancyhead[EC]{\sffamily\nouppercase\leftmark}
    \fancyhead[OC]{\sffamily\nouppercase\rightmark}
    \fancyfoot[LE,RO]{\hfill{\sffamily\thepage}\hfill}
    \renewcommand{\headrulewidth}{1pt}
    \renewcommand{\footrulewidth}{0pt}
    \renewcommand{\headrule}{\hbox to\headwidth{\leaders\hrule height \headrulewidth\hfill}}
}

%% Plain page style.
\fancypagestyle{plain}{
    \fancyhf{}
    \cfoot{\sffamily\thepage}
    \renewcommand{\headrulewidth}{0pt}
    \renewcommand{\footrulewidth}{0pt}
}

%% Adjust header height to avoid warnings from fancyhdr.
\setlength{\headheight}{20.39996pt}
\addtolength{\topmargin}{-8.39996pt}

%% Print current font command for debugging font issues.
\makeatletter
\newcommand{\printcurrentfont}{
    \begingroup\escapechar=\m@ne
    \expandafter\expandafter\expandafter\split@name\expandafter\string\the\font\@nil
    \begin{tabular}{ll}
        Encoding: & \f@encoding             \\
        Family:   & \f@family               \\
        Series:   & \f@series               \\
        Shape:    & \f@shape                \\
        Size:     & \f@size                 \\
        Example:  & {\the\font abc ABC 123} \\
        External: & \fontname\font          \\
        TF0:      & \fontname\textfont0
    \end{tabular}
    \endgroup
}
\makeatother

%% Input colours and environments.
\input{tex/colours-and-environments.tex}

%% Always (re)define tudelft-cyaan (used in hyperlinks by default).
\definecolor{tudelft-cyaan}{RGB}{0,166,214}

%% Hyperref setup (option between coloured links and hidelinks).
% \usepackage[hidelinks]{hyperref}
\usepackage[colorlinks,allcolors=tudelft-cyaan]{hyperref}

%% Command for cleveref package. Should be below hyperref.
\usepackage{cleveref}
\crefname{table}{Table}{Tables}
\crefname{section}{Section}{Sections}
\crefname{subsection}{Subsection}{Subsections}
\crefname{figure}{Figure}{Figures}
\crefname{equation}{equation}{equations}